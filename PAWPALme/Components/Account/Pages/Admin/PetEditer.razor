@page "/admin/pets/add"
@page "/admin/pets/edit/{Id:int}"
@using Microsoft.AspNetCore.Authorization
@attribute [Authorize(Roles = "Admin")]
@using PAWPALme.Models
@using PAWPALme.Services
@using System.IO
@inject PetService PetService
@inject NavigationManager Nav
@inject IWebHostEnvironment Env

<PageTitle>@(Id == null ? "Add New Pet" : "Edit Pet")</PageTitle>

<div class="container mt-4" style="max-width: 600px;">
    <div class="card shadow">
        <div class="card-header bg-success text-white">
            <h4 class="mb-0">@(Id == null ? "Add New Pet" : "Edit Pet")</h4>
        </div>
        <div class="card-body">

            <EditForm Model="pet" OnValidSubmit="HandleSubmit">
                <DataAnnotationsValidator />
                <ValidationSummary />

                <div class="mb-3">
                    <label class="form-label">Name</label>
                    <InputText class="form-control" @bind-Value="pet.Name" />
                </div>

                <div class="row g-2 mb-3">
                    <div class="col-md-6">
                        <label class="form-label">Species</label>
                        <InputSelect class="form-select" @bind-Value="pet.Species">
                            <option value="Dog">Dog</option>
                            <option value="Cat">Cat</option>
                            <option value="Other">Other</option>
                        </InputSelect>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Breed</label>
                        <InputText class="form-control" @bind-Value="pet.Breed" />
                    </div>
                </div>

                <div class="row g-2 mb-3">
                    <div class="col-md-6">
                        <label class="form-label">Age</label>
                        <InputNumber class="form-control" @bind-Value="pet.Age" />
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Status</label>
                        <InputSelect class="form-select" @bind-Value="pet.Status">
                            <option value="Available">Available</option>
                            <option value="Pending">Pending</option>
                            <option value="Adopted">Adopted</option>
                        </InputSelect>
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label">Description</label>
                    <InputTextArea class="form-control" @bind-Value="pet.Description" rows="4" />
                </div>

                <div class="mb-3">
                    <label class="form-label">Shelter ID</label>
                    <InputNumber class="form-control" @bind-Value="pet.ShelterId" />
                </div>

                <div class="d-flex justify-content-between">
                    <a href="/admin/pets" class="btn btn-secondary">Cancel</a>
                    <button type="submit" class="btn btn-success">Save Pet</button>
                </div>
            </EditForm>

        </div>
    </div>
</div>

@code {
    [Parameter] public int? Id { get; set; }

    private Pet pet = new();

    protected override async Task OnInitializedAsync()
    {
        if (Id is not null)
        {
            var existing = await PetService.GetPetByIdAsync(Id.Value);
            if (existing is not null)
                pet = existing;
        }
    }

    private async Task HandleSubmit()
    {
        if (Id is null)
            await PetService.AddPetAsync(pet);
        else
            await PetService.UpdatePetAsync(pet);

        Nav.NavigateTo("/admin/pets");
    }
}
